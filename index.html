<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç´éŸ³äº”è¡ŒÂ·æ„è±¡è«–å‘½ (ç²¾æº–é‚è¼¯ç‰ˆ)</title>
    <meta name="description" content="è¼¸å…¥ç”Ÿæ—¥ï¼Œé€éç´éŸ³äº”è¡Œä¸‰ä½ä¸€é«”æ¶æ§‹ï¼Œæä¾›å…·è±¡åŒ–çš„å¼·å¼±äº’å‹•é‹å‹¢åˆ†æã€‚">
    
    <!-- å¼•å…¥ Lunar.js -->
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript@1.6.12/lunar.js"></script>
    
    <style>
        :root {
            --primary: #2d3436;
            --accent: #6c5ce7;
            --bg: #f4f7f6;
            --card-bg: #ffffff;
            --text: #2d3436;
            --border-radius: 16px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: "PingFang TC", "Microsoft JhengHei", -apple-system, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 15px 10px;
            line-height: 1.6;
            font-size: 15px;
        }

        .container { max-width: 650px; margin: 0 auto; }
        
        /* é ‚éƒ¨ä»Šæ—¥æ°£å ´ */
        .today-card {
            background: linear-gradient(135deg, #6c5ce7, #a29bfe);
            border-radius: var(--border-radius);
            padding: 20px;
            color: white;
            margin-bottom: 20px;
            box-shadow: 0 8px 20px rgba(108, 92, 231, 0.2);
        }
        .today-title { text-align: center; font-size: 1.1rem; margin-bottom: 15px; font-weight: bold; letter-spacing: 1px; opacity: 0.9; }
        .today-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .t-box {
            background: rgba(255,255,255,0.2); border-radius: 10px; padding: 10px 5px;
            text-align: center; backdrop-filter: blur(5px);
        }
        .t-label { font-size: 0.8rem; opacity: 0.8; margin-bottom: 4px; }
        .t-val { font-size: 1.2rem; font-weight: bold; text-shadow: 0 2px 4px rgba(0,0,0,0.1); }

        /* é€šç”¨å¡ç‰‡ */
        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.03);
        }

        h2 { 
            font-size: 1.1rem; margin: 0 0 15px 0; color: var(--primary);
            border-left: 4px solid var(--accent); padding-left: 10px;
            display: flex; align-items: center;
        }

        /* è¼¸å…¥èˆ‡æŒ‰éˆ• */
        .input-area { text-align: center; }
        input[type="date"] {
            width: 100%; padding: 14px; margin-bottom: 12px;
            border: 2px solid #dfe6e9; border-radius: 12px;
            font-size: 1.1rem; outline: none; -webkit-appearance: none; text-align: center;
        }
        button {
            width: 100%; padding: 16px;
            background: var(--accent); color: white; border: none; border-radius: 12px;
            font-size: 1.1rem; font-weight: bold; cursor: pointer;
            box-shadow: 0 4px 10px rgba(108, 92, 231, 0.3);
            transition: transform 0.2s;
        }
        button:active { transform: scale(0.98); }

        /* å‘½ç›¤æ¨£å¼ */
        .pillars-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 15px; }
        .p-box {
            background: #f8f9fa; border-radius: 10px; padding: 12px 5px;
            text-align: center; border: 1px solid #eee;
        }
        .p-role { font-size: 0.75rem; color: #888; margin-bottom: 4px; }
        .p-gz { font-size: 1rem; font-weight: bold; color: #333; margin-bottom: 2px;}
        .p-ny { font-size: 0.95rem; font-weight: 600; color: var(--accent); }

        /* é‹å‹¢å¡ç‰‡ */
        .fortune-item { 
            border: 1px solid #eee; border-radius: 12px; 
            padding: 15px; margin-bottom: 15px; background: #fff;
        }
        .f-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; border-bottom: 1px dashed #eee; padding-bottom: 8px;}
        .f-title { font-weight: bold; font-size: 1.05rem; color: #2d3436; }
        .f-badge { 
            font-size: 0.8rem; padding: 4px 10px; border-radius: 20px; 
            color: #fff; font-weight: bold; background: #b2bec3;
        }
        
        .scene-box {
            background: #f1f2f6; padding: 12px; border-radius: 8px; margin: 10px 0;
            font-weight: 600; color: #2d3436; font-size: 0.95rem;
            border-left: 4px solid #a29bfe;
        }
        .f-text { font-size: 0.95rem; color: #555; text-align: justify; line-height: 1.7; }
        .f-text strong { color: #2d3436; }
        
        .lucky-tip {
            margin-top: 12px; font-size: 0.9rem; background: #fff8e1; 
            padding: 10px; border-radius: 8px; color: #d35400; display: flex; gap: 6px;
        }

        .hidden { display: none; }
        #loading-msg { text-align: center; color: #888; margin-top: 10px; display: none; }
        
        /* å¼·å¼±æ¨™ç±¤ */
        .strength-tag { font-size: 0.7rem; background: #eee; padding: 1px 4px; border-radius: 3px; color: #666; vertical-align: middle; margin-left: 4px; }
    </style>
</head>
<body>

<div class="container">
    <!-- 1. ä»Šæ—¥æ°£å ´ (æœ€ä¸Šæ–¹é¡¯ç¤º) -->
    <div class="today-card">
        <div class="today-title">ğŸ“… ä»Šæ—¥ç´éŸ³æ°£å ´</div>
        <div class="today-grid">
            <div class="t-box">
                <div class="t-label">æµå¹´ (æ ¹åŸº)</div>
                <div class="t-val" id="tY_NY">--</div>
            </div>
            <div class="t-box">
                <div class="t-label">æµæœˆ (ç’°å¢ƒ)</div>
                <div class="t-val" id="tM_NY">--</div>
            </div>
            <div class="t-box">
                <div class="t-label">æµæ—¥ (æ©Ÿé‡)</div>
                <div class="t-val" id="tD_NY">--</div>
            </div>
        </div>
    </div>

    <div class="card">
        <h2>ğŸ‘¤ è¼¸å…¥ç”Ÿæ—¥æŸ¥çœ‹æ„è±¡</h2>
        <div class="input-area">
            <input type="date" id="birthdate">
            <button onclick="startAnalysis()">ğŸ”® å•Ÿå‹•æ„è±¡åˆ†æ</button>
            <div id="loading-msg">æ­£åœ¨æ¯”å°ç´éŸ³å¼·å¼±é—œä¿‚...</div>
        </div>
    </div>

    <div id="result-area" class="hidden">
        
        <!-- å‘½ç›¤ -->
        <div class="card">
            <h2>ğŸ§¬ æ‚¨çš„ç´éŸ³çµæ§‹</h2>
            <div class="pillars-grid">
                <div class="p-box">
                    <div class="p-role">å¹´æŸ± (æœ¬è³ª)</div>
                    <div class="p-gz" id="uY_GZ">--</div>
                    <div class="p-ny" id="uY_NY">--</div>
                </div>
                <div class="p-box">
                    <div class="p-role">æœˆæŸ± (å…§å¿ƒ)</div>
                    <div class="p-gz" id="uM_GZ">--</div>
                    <div class="p-ny" id="uM_NY">--</div>
                </div>
                <div class="p-box">
                    <div class="p-role">æ—¥æŸ± (å¤–åœ¨)</div>
                    <div class="p-gz" id="uD_GZ">--</div>
                    <div class="p-ny" id="uD_NY">--</div>
                </div>
            </div>
            <div id="personality-text" class="f-text" style="background:#f9f9f9; padding:10px; border-radius:8px;"></div>
        </div>

        <!-- å®è§€é‹å‹¢ -->
        <div class="card">
            <h2>ğŸŒ æµå¹´èˆ‡æµæœˆé‹å‹¢</h2>
            <div id="macro-content"></div>
        </div>

        <!-- ä»Šæ—¥ç´°é … -->
        <div class="card">
            <h2>ğŸŒ ä»Šæ—¥é‹å‹¢ç´°é …</h2>
            <div id="daily-content"></div>
        </div>
    </div>
</div>

<script>
    // ===========================================================
    // 1. ç´éŸ³æ ¸å¿ƒè³‡æ–™åº« (åŒ…å«ç¹ç°¡å°ç…§ã€å¼·åº¦ã€å…·è±¡)
    // ===========================================================
    // Strength: 1(æ¥µå¼±) ~ 5(æ¥µå¼·)
    // Type: ç”¨æ–¼ç”Ÿæˆèªå¥çš„åˆ†é¡
    const DB = {
        // --- é‡‘ ---
        "æµ·ä¸­é‡‘": { el: "é‡‘", str: 2, img: "æ·±æµ·å¯¶è—", desc: "æ·±è—æµ·åº•ï¼Œå«è“„å…§æ–‚" }, 
        "åŠé‹’é‡‘": { el: "é‡‘", str: 5, img: "å€šå¤©åˆ©åˆƒ", desc: "é‹’åˆ©ç„¡æ¯”ï¼Œç„¡å …ä¸æ‘§" },
        "ç™½è Ÿé‡‘": { el: "é‡‘", str: 1, img: "ç¤¦çŸ³åŸé‡‘", desc: "æœªç¶“é›é€ ï¼Œè³ªåœ°è»Ÿå¼±" },
        "æ²™ä¸­é‡‘": { el: "é‡‘", str: 3, img: "æ²™è£¡æ·˜é‡‘", desc: "æ··æ–¼æ²™çŸ³ï¼Œéœ€ç¶“æ·˜æ´—" },
        "é‡‘ç®”é‡‘": { el: "é‡‘", str: 1, img: "é‡‘ç®”è²¼ç´™", desc: "è–„å¦‚èŸ¬ç¿¼ï¼Œè£é£¾ç‚ºä¸»" },
        "é‡µé‡§é‡‘": { el: "é‡‘", str: 2, img: "é‡‘éŠ€é¦–é£¾", desc: "æŸ”ç¾æˆå™¨ï¼Œä¸è€é‡æ“Š" },

        // --- æœ¨ ---
        "æ¡‘æŸ˜æœ¨": { el: "æœ¨", str: 3, img: "æ¡‘æ¨¹è‰¯æ", desc: "ç”¨é€”å»£æ³›ï¼Œå‰›æŸ”ä¸¦æ¿Ÿ" },
        "æ¾æŸæœ¨": { el: "æœ¨", str: 5, img: "å‚²é›ªæ¾æŸ", desc: "å …æ¯…æŒºæ‹”ï¼Œä¸ç•åš´å¯’" },
        "å¤§æ—æœ¨": { el: "æœ¨", str: 4, img: "åŸå§‹æ£®æ—", desc: "æè‘‰ç¹èŒ‚ï¼Œé¬±é¬±è”¥è”¥" },
        "æ¥ŠæŸ³æœ¨": { el: "æœ¨", str: 2, img: "æ²³ç•”æ¥ŠæŸ³", desc: "éš¨é¢¨é£„è•©ï¼ŒæŸ”é †å½æ›²" },
        "çŸ³æ¦´æœ¨": { el: "æœ¨", str: 3, img: "çŸ³æ¦´æœæ¨¹", desc: "æ€§è¾›å¦‚ç«ï¼Œå¤–å‰›å…§ç§€" },
        "å¹³åœ°æœ¨": { el: "æœ¨", str: 2, img: "åˆç”Ÿè‰æœ¨", desc: "æ ¹åŸºæœªç©©ï¼Œéœ€è¦å‘µè­·" },

        // --- æ°´ ---
        "æ¾—ä¸‹æ°´": { el: "æ°´", str: 2, img: "å±±é–“æ¸…æ³‰", desc: "æ¸…æ¾ˆé€æ˜ï¼Œæ¶“æ¶“ç´°æµ" },
        "å¤§æºªæ°´": { el: "æ°´", str: 4, img: "é©šæ¿¤é§­æµª", desc: "å¥”é¨°ä¸æ¯ï¼Œæ°£å‹¢ç£…ç¤´" },
        "é•·æµæ°´": { el: "æ°´", str: 3, img: "é•·æ±Ÿå¤§æ²³", desc: "æºé æµé•·ï¼Œç¶¿å»¶ä¸çµ•" },
        "å¤©æ²³æ°´": { el: "æ°´", str: 5, img: "å¤©ä¸Šé›¨éœ²", desc: "æ™®é™ç”˜éœ–ï¼Œç„¡ç§å¥‰ç»" },
        "äº•æ³‰æ°´": { el: "æ°´", str: 2, img: "äº•åº•æ·±æ³‰", desc: "å†·å†½ç”˜ç”œï¼Œæ·±ä¸å¯æ¸¬" },
        "å¤§æµ·æ°´": { el: "æ°´", str: 5, img: "æµ©ç€šæ±ªæ´‹", desc: "ç´ç™¾å·ï¼ŒåŒ…å®¹è¬ç‰©" },

        // --- ç« ---
        "çˆä¸­ç«": { el: "ç«", str: 4, img: "çˆä¸­çƒˆç«", desc: "èšé›†ç‡ƒç‡’ï¼Œå†¶ç…‰è¬ç‰©" },
        "å±±é ­ç«": { el: "ç«", str: 3, img: "å±±é ‚å¤•ç…§", desc: "å…‰èŠ’å››å°„ï¼Œç¬é–“çˆ†ç™¼" },
        "éœ¹é‚ç«": { el: "ç«", str: 5, img: "é›·éœ†é–ƒé›»", desc: "å‰›çƒˆæš´èºï¼Œè²å‹¢é©šäºº" },
        "å±±ä¸‹ç«": { el: "ç«", str: 2, img: "è¢ç«å¾®å…‰", desc: "æº«æš–å«è“„ï¼Œä¸æ˜“å¯Ÿè¦º" },
        "è¦†ç‡ˆç«": { el: "ç«", str: 2, img: "ä½›å‰æ²¹ç‡ˆ", desc: "å¤œé–“ç…§æ˜ï¼Œå°ˆæ³¨æŒ‡å¼•" },
        "å¤©ä¸Šç«": { el: "ç«", str: 5, img: "è±”é™½çƒˆæ—¥", desc: "å…¬æ­£ç„¡ç§ï¼Œæ™®ç…§å¤§åœ°" },

        // --- åœŸ ---
        "è·¯æ—åœŸ": { el: "åœŸ", str: 3, img: "è·¯é‚Šå¡µåœŸ", desc: "éš¨å’Œå¯¬åšï¼Œæ»‹é¤Šè¬ç‰©" },
        "åŸé ­åœŸ": { el: "åœŸ", str: 4, img: "é˜²ç¦¦é«˜ç‰†", desc: "åšé‡å›ºå®ˆï¼ŒåŸå‰‡æ€§å¼·" },
        "å±‹ä¸ŠåœŸ": { el: "åœŸ", str: 2, img: "ç“¦ç‰‡ä¹‹åœŸ", desc: "é®é¢¨é¿é›¨ï¼Œæˆå°±æœ‰é™" },
        "å£ä¸ŠåœŸ": { el: "åœŸ", str: 2, img: "ç²‰ç‰†ä¹‹åœŸ", desc: "ä¾é™„æ£Ÿæ¨‘ï¼Œç¼ºä¹ç¨ç«‹" },
        "å¤§é©›åœŸ": { el: "åœŸ", str: 4, img: "é€šé”å¤§é“", desc: "æ‰¿è¼‰åšé‡ï¼Œèƒ¸è¥Ÿå»£é—Š" },
        "æ²™ä¸­åœŸ": { el: "åœŸ", str: 2, img: "æµå‹•ä¹‹æ²™", desc: "è®ŠåŒ–å¤šç«¯ï¼Œèšæ•£ç„¡å¸¸" }
    };

    // ç¹ç°¡å°ç…§èˆ‡åˆ¥åæ˜ å°„
    const ALIAS = {
        "å‰‘é”‹é‡‘": "åŠé‹’é‡‘", "ç™½èœ¡é‡‘": "ç™½è Ÿé‡‘", "é’—é’é‡‘": "é‡µé‡§é‡‘",
        "æ¨æŸ³æœ¨": "æ¥ŠæŸ³æœ¨", "æ¶§ä¸‹æ°´": "æ¾—ä¸‹æ°´", "é•¿æµæ°´": "é•·æµæ°´", "æ³‰ä¸­æ°´": "äº•æ³‰æ°´",
        "ç‚‰ä¸­ç«": "çˆä¸­ç«", "å±±å¤´ç«": "å±±é ­ç«", "éœ¹é›³ç«": "éœ¹é‚ç«", "ä½›ç‡ˆç«": "è¦†ç‡ˆç«",
        "åŸå¤´åœŸ": "åŸé ­åœŸ", "å¤§é©¿åœŸ": "å¤§é©›åœŸ", "é‡‘è–„é‡‘": "é‡‘ç®”é‡‘"
    };

    const RELATION_MAP = {
        "é‡‘": { "é‡‘":"æ¯”å’Œ", "æœ¨":"æˆ‘å‰‹", "æ°´":"æˆ‘ç”Ÿ", "ç«":"å‰‹æˆ‘", "åœŸ":"ç”Ÿæˆ‘" },
        "æœ¨": { "é‡‘":"å‰‹æˆ‘", "æœ¨":"æ¯”å’Œ", "æ°´":"ç”Ÿæˆ‘", "ç«":"æˆ‘ç”Ÿ", "åœŸ":"æˆ‘å‰‹" },
        "æ°´": { "é‡‘":"ç”Ÿæˆ‘", "æœ¨":"æˆ‘ç”Ÿ", "æ°´":"æ¯”å’Œ", "ç«":"æˆ‘å‰‹", "åœŸ":"å‰‹æˆ‘" },
        "ç«": { "é‡‘":"æˆ‘å‰‹", "æœ¨":"ç”Ÿæˆ‘", "æ°´":"å‰‹æˆ‘", "ç«":"æ¯”å’Œ", "åœŸ":"æˆ‘ç”Ÿ" },
        "åœŸ": { "é‡‘":"æˆ‘ç”Ÿ", "æœ¨":"å‰‹æˆ‘", "æ°´":"æˆ‘å‰‹", "ç«":"ç”Ÿæˆ‘", "åœŸ":"æ¯”å’Œ" }
    };

    let todayData = {};

    // ===========================================================
    // 2. åˆå§‹åŒ–èˆ‡ä»Šæ—¥è³‡æ–™æŠ“å–
    // ===========================================================
    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('birthdate').valueAsDate = new Date();
        initToday();
    });

    function initToday() {
        try {
            const now = new Date();
            const lunar = Solar.fromYmd(now.getFullYear(), now.getMonth()+1, now.getDate()).getLunar();
            
            todayData = {
                y: lunar.getYearNaYin(),
                m: lunar.getMonthNaYin(),
                d: lunar.getDayNaYin()
            };

            // è½‰æ›é¡¯ç¤ºç‚ºç¹é«” (é€é DB æŸ¥æ‰¾)
            document.getElementById('tY_NY').textContent = normalize(todayData.y);
            document.getElementById('tM_NY').textContent = normalize(todayData.m);
            document.getElementById('tD_NY').textContent = normalize(todayData.d);
        } catch (e) {
            console.log("Library loading...");
            setTimeout(initToday, 500);
        }
    }

    function normalize(name) {
        if (DB[name]) return name;
        if (ALIAS[name]) return ALIAS[name];
        // å‰ç¶´åŒ¹é…
        for (let key in DB) {
            if (name.startsWith(key.substring(0, 2))) return key;
        }
        return name;
    }

    // ===========================================================
    // 3. åˆ†æé‚è¼¯ (å¼·å¼±äº’å‹•æ ¸å¿ƒ)
    // ===========================================================
    function startAnalysis() {
        if (typeof Solar === 'undefined') return alert("ç³»çµ±æ ¸å¿ƒè¼‰å…¥ä¸­ï¼Œè«‹ç¨å¾Œå†æŒ‰...");
        
        const dStr = document.getElementById('birthdate').value;
        if (!dStr) return;

        document.getElementById('loading-msg').style.display = 'block';
        document.getElementById('result-area').classList.add('hidden');

        if(!todayData.y) initToday();

        setTimeout(() => {
            try {
                const [y,m,d] = dStr.split('-').map(Number);
                const lunar = Solar.fromYmd(y,m,d).getLunar();
                
                const user = {
                    yGZ: lunar.getYearInGanZhi(), yNY: lunar.getYearNaYin(),
                    mGZ: lunar.getMonthInGanZhi(), mNY: lunar.getMonthNaYin(),
                    dGZ: lunar.getDayInGanZhi(), dNY: lunar.getDayNaYin()
                };

                renderPillars(user);
                renderMacro(user);
                renderDaily(user);

                document.getElementById('result-area').classList.remove('hidden');
                document.getElementById('loading-msg').style.display = 'none';
                document.getElementById('result-area').scrollIntoView({behavior:'smooth'});
            } catch (e) {
                alert("åˆ†æéŒ¯èª¤: " + e.message);
            }
        }, 300);
    }

    function renderPillars(u) {
        // é¡¯ç¤ºæŸ±å­
        setTxt('uY_GZ', u.yGZ); setTxt('uY_NY', normalize(u.yNY));
        setTxt('uM_GZ', u.mGZ); setTxt('uM_NY', normalize(u.mNY));
        setTxt('uD_GZ', u.dGZ); setTxt('uD_NY', normalize(u.dNY));

        // äººæ ¼æè¿°
        const yInfo = getData(u.yNY);
        const mInfo = getData(u.mNY);
        const dInfo = getData(u.dNY);

        document.getElementById('personality-text').innerHTML = 
            `<b>ğŸŒŸ æ ¸å¿ƒæœ¬è³ª (å¹´)ï¼šã€${normalize(u.yNY)}ã€‘${yInfo.img}</b><br>æ‚¨çš„éˆé­‚åº•è‰²å¦‚åŒ${yInfo.desc}ï¼Œé€™æ±ºå®šäº†æ‚¨äººç”Ÿçš„å¤§æ–¹å‘ã€‚<br><br>` +
            `<b>ğŸŒ™ å…§åœ¨å‹•æ©Ÿ (æœˆ)ï¼šã€${normalize(u.mNY)}ã€‘${mInfo.img}</b><br>æ‚¨çš„æƒ…æ„Ÿéœ€æ±‚å¦‚åŒ${mInfo.desc}ï¼Œé€™æ˜¯æ‚¨å®‰å…¨æ„Ÿçš„ä¾†æºã€‚<br><br>` +
            `<b>ğŸ­ å¤–åœ¨è¡Œç‚º (æ—¥)ï¼šã€${normalize(u.dNY)}ã€‘${dInfo.img}</b><br>æ‚¨å°å¤–çš„è™•äº‹é¢¨æ ¼å¦‚åŒ${dInfo.desc}ï¼Œé€™æ˜¯åˆ¥äººçœ¼ä¸­çš„æ‚¨ã€‚`;
    }

    // ===========================================================
    // 4. æ„è±¡ç”Ÿæˆå¼•æ“ (é—œéµé‚è¼¯ä¿®æ”¹)
    // ===========================================================
    function getData(name) {
        name = normalize(name);
        return DB[name] || { el:"åœŸ", str:2, img:"æœªçŸ¥æ„è±¡", desc:"è³‡æ–™è§£æä¸­" };
    }

    // æ ¸å¿ƒï¼šå¼·å¼±äº’å‹•åˆ†æ (é¡¯ååŒ– + é‚è¼¯è§£é‡‹)
    function analyzeInteraction(meName, otherName) {
        const meNameNorm = normalize(meName);
        const otherNameNorm = normalize(otherName);
        const me = getData(meNameNorm);
        const other = getData(otherNameNorm);
        const rel = RELATION_MAP[me.el][other.el];

        let res = { grade: "å¹³", color: "#b2bec3", title: "", scene: "", logic: "" };
        
        // é€šç”¨è®Šæ•¸ï¼šæ¨™ç±¤ (ç”¨æ–¼é¡¯ç¤ºåœ¨è§£é‡‹ä¸­)
        const meLabel = `æ‚¨çš„ã€${meNameNorm}ã€‘(${me.img})`;
        const otherLabel = `æµé‹çš„ã€${otherNameNorm}ã€‘(${other.img})`;

        // é‚è¼¯è§£é‡‹åº« (ç‚ºä»€éº¼æœƒé€™æ¨£ï¼Ÿ)
        const reason = {
            "æˆ‘ç”Ÿ": {
                "é‡‘æ°´": "é‡‘å±¬é”åŒ–æˆ–æŒ–æ˜æ¸ é“ï¼Œèƒ½ç–é€šæ°´æºã€‚",
                "æ°´æœ¨": "æ°´æµæ»‹æ½¤æ ¹ç³»ï¼ŒåŠ©è‰æœ¨ç”Ÿé•·ã€‚",
                "æœ¨ç«": "æœ¨æç‡ƒç‡’åŠ©é•·ç«å‹¢ï¼Œè‡ªæˆ‘çŠ§ç‰²æˆå°±å…‰äº®ã€‚",
                "ç«åœŸ": "ç«ç‡’æˆç°è½‰åŒ–ç‚ºåœŸï¼Œèƒ½é‡æ²‰æ¾±ç‚ºåŸºçŸ³ã€‚",
                "åœŸé‡‘": "åœŸå±¤æ·±åšå­•è‚²ç¤¦è„ˆï¼Œä¿è­·ä¸¦ç”¢å‡ºé‡‘å±¬ã€‚"
            },
            "ç”Ÿæˆ‘": {
                "é‡‘æ°´": "é‡‘æ°£ç”Ÿæ°´ï¼Œæ‚¨ç²å¾—äº†æºé ­æ´»æ°´çš„è³‡åŠ©ã€‚",
                "æ°´æœ¨": "æ°´ä¾†é¤Šæœ¨ï¼Œæ‚¨ç²å¾—äº†æ»‹é¤Šèˆ‡æˆé•·çš„è³‡æºã€‚",
                "æœ¨ç«": "æœ¨ä¾†ç”Ÿç«ï¼Œæ‚¨ç²å¾—äº†ç‡ƒæ–™ï¼Œå‹•åŠ›å¤§å¢ã€‚",
                "ç«åœŸ": "ç«ä¾†ç”ŸåœŸï¼Œæ‚¨ç²å¾—äº†æº«æš–èˆ‡è½‰åŒ–çš„åŠ›é‡ã€‚",
                "åœŸé‡‘": "åœŸä¾†ç”Ÿé‡‘ï¼Œæ‚¨ç²å¾—äº†ç©©å›ºçš„é å±±èˆ‡è³‡æºã€‚"
            }
        };

        // 1. æˆ‘å‰‹ (æˆ‘å»æŒæ§)
        if (rel === "æˆ‘å‰‹") {
            if (me.str >= 4 && other.str <= 2) {
                // å¼·å‰‹å¼± -> ä¿®å‰ªæˆåŠŸ
                res.grade = "å¤§å‰"; res.color = "#00b894"; res.title = "ä¿®å‰ªæˆæ";
                res.scene = `${meLabel} ç²¾æº–åœ°ä¿®é£¾äº† ${otherLabel}`;
                res.logic = `é€™å°±åƒ**åˆ©åŠä¿®å‰ªå¤šé¤˜çš„æè‘‰**ã€‚å› ç‚ºæ‚¨çš„${me.el}æ°£å ´å¼·æ—ºï¼Œè€Œå°æ–¹çš„${other.el}æ°£å ´è¼ƒå¼±ï¼Œæ‚¨æ“æœ‰è¶³å¤ çš„èƒ½åŠ›å»æŒæ§å±€å‹¢ï¼Œèƒ½å°‡æ··äº‚çš„è³‡æºæ•´ç†å‡ºåƒ¹å€¼ï¼Œæˆæœè±ç¢©ã€‚`;
            } else if (me.str <= 2 && other.str >= 4) {
                // å¼±å‰‹å¼· -> åå—å…¶è¾±
                res.grade = "å‡¶"; res.color = "#d63031"; res.title = "éˆåˆ€ä¼æœ¨";
                res.scene = `${meLabel} è©¦åœ–æ’¼å‹•é¾å¤§çš„ ${otherLabel}`;
                res.logic = `é€™å°±åƒ**æ‹¿å°åˆ€å»ç åƒå¤©å¤§æ¨¹**ã€‚æ‚¨çš„${me.el}æ°£å ´ç›¸å°å¾®å¼±ï¼Œç„¡æ³•é§•é¦­å¼·å¤§çš„${other.el}èƒ½é‡ï¼Œå¼·è¡Œä¸»å°åè€Œæœƒè®“è‡ªå·±çš„å·¥å…·å—æã€‚é€™æ®µæ™‚é–“ä¸å®œå¼·å‡ºé ­ã€‚`;
            } else {
                // å‹¢å‡åŠ›æ•µ
                res.grade = "ä¸­å‰"; res.color = "#0984e3"; res.title = "å‹¢åœ¨å¿…å¾—";
                res.scene = `${meLabel} æ­£åŠªåŠ›å»é§•é¦­ ${otherLabel}`;
                res.logic = `é›™æ–¹åŠ›é‡ç›¸ç•¶ï¼Œé›–ç„¶èƒ½å¤ æŒæ§ï¼Œä½†éœ€è¦ä»˜å‡ºç›¸ç•¶çš„åŠªåŠ›ã€‚é€™æ˜¯ä¸€å€‹éœ€è¦å°ˆæ³¨èˆ‡å …æŒçš„éç¨‹ã€‚`;
            }
        }
        
        // 2. å‰‹æˆ‘ (å¤–åœ¨å£“åŠ›)
        else if (rel === "å‰‹æˆ‘") {
            if (other.el === "ç«" && me.el === "é‡‘") {
                // ç«ç…‰é‡‘ (ç‰¹æ®Šå‰)
                res.grade = "å‰"; res.color = "#0984e3"; res.title = "çƒˆç«ç…‰é‡‘";
                res.scene = `${otherLabel} æ­£åœ¨é«˜æº«é›é€ æ‚¨çš„ ${meLabel}`;
                res.logic = `é›–ç„¶å£“åŠ›å·¨å¤§ï¼Œä½†é€™æ­£æ˜¯**è„«èƒæ›éª¨**çš„æ©Ÿæœƒã€‚ç«èƒ½å»é™¤é‡‘çš„é›œè³ªï¼Œç¶“éé€™ç•ªè€ƒé©—ï¼Œæ‚¨çš„åƒ¹å€¼å°‡æœƒå€å¢ã€‚`;
            } else if (other.str >= 4 && me.str <= 2) {
                // å¼·å‰‹å¼± -> æ³°å±±å£“é ‚
                res.grade = "å¤§å‡¶"; res.color = "#d63031"; res.title = "é­å—é‡æ“Š";
                res.scene = `å¼·å‹¢çš„ ${otherLabel} ç„¡æƒ…åœ°å£“åˆ¶äº† ${meLabel}`;
                res.logic = `é€™å°±åƒ**ç‹‚é¢¨æš´é›¨æ‘§æ®˜å¹¼è‹—**ã€‚å¤–åœ¨${other.el}æ°£å ´æ¥µå¼·ï¼Œå°æ‚¨çš„${me.el}å½¢æˆçµ•å°å£“åˆ¶ã€‚å»ºè­°æš«æ™‚éš±å¿ï¼Œå°‹æ‰¾æ©è­·ã€‚`;
            } else if (other.str <= 2 && me.str >= 4) {
                // å¼±å‰‹å¼· -> éš”é´æ”ç™¢
                res.grade = "å°å‰"; res.color = "#fab1a0"; res.title = "å¾®å—å¹²æ“¾";
                res.scene = `å¾®å¼±çš„ ${otherLabel} è©¦åœ–é™åˆ¶å¼·å¤§çš„ ${meLabel}`;
                res.logic = `å¤–åœ¨çš„é˜»åŠ›å¾®ä¸è¶³é“ï¼Œå°±åƒ**èšŠèŸ²å®å’¬**ã€‚é›–ç„¶æœ‰äº›ç…©äººï¼Œä½†ç„¡æ³•çœŸæ­£æ’¼å‹•æ‚¨çš„æ ¹åŸºã€‚ä¿æŒè‡ªä¿¡ï¼Œç¹¼çºŒå‰è¡Œå³å¯ã€‚`;
            } else {
                res.grade = "å‡¶"; res.color = "#fab1a0"; res.title = "å—åˆ°é™åˆ¶";
                res.scene = `${otherLabel} é™åˆ¶äº† ${meLabel} çš„ç™¼æ®`;
                res.logic = `ç’°å¢ƒå°æ‚¨æœ‰æ‰€é™åˆ¶ï¼Œæ„Ÿè¦ºæ–½å±•ä¸é–‹ã€‚å»ºè­°æ¡å–ä¿å®ˆç­–ç•¥ã€‚`;
            }
        }

        // 3. ç”Ÿæˆ‘ (ç²å¾—è³‡æº)
        else if (rel === "ç”Ÿæˆ‘") {
            const why = reason["ç”Ÿæˆ‘"][other.el + me.el] || "äº”è¡Œç›¸ç”Ÿï¼Œèƒ½é‡å‚³éã€‚";
            if (other.str >= 4) {
                res.grade = "å¤§å‰"; res.color = "#00b894"; res.title = "ç”˜éœ–æ»‹æ½¤";
                res.scene = `è±æ²›çš„ ${otherLabel} æºæºä¸çµ•åœ°æ»‹é¤Š ${meLabel}`;
                res.logic = `é€™å°±åƒ**ä¹…æ—±é€¢ç”˜éœ–**ã€‚${why}è³‡æºèˆ‡è²´äººä¸»å‹•ä¾†åˆ°é¢å‰ï¼Œæ‚¨ç„¡éœ€è²»åŠ›çˆ­å–å°±èƒ½ç²å¾—æ”¯æŒã€‚`;
            } else {
                res.grade = "å‰"; res.color = "#00b894"; res.title = "å°æœ‰åŠ©ç›Š";
                res.scene = `${otherLabel} çµ¦äºˆ ${meLabel} æº«æš–çš„æ”¯æŒ`;
                res.logic = `é›–ç„¶ä¸æ˜¯å·¨å¤§çš„è²¡å¯Œï¼Œä½†${why}ï¼Œè®“æ‚¨æ„Ÿåˆ°èˆ’é©å®‰å¿ƒã€‚`;
            }
        }

        // 4. æˆ‘ç”Ÿ (ä»˜å‡ºå±•ç¾)
        else if (rel === "æˆ‘ç”Ÿ") {
            const why = reason["æˆ‘ç”Ÿ"][me.el + other.el] || "äº”è¡Œæµè½‰ï¼Œèƒ½é‡è¼¸å‡ºã€‚";
            if (me.str <= 2) {
                res.grade = "å‡¶"; res.color = "#fdcb6e"; res.title = "æ¶ˆè€—éåº¦";
                res.scene = `è™›å¼±çš„ ${meLabel} å‹‰å¼·å»æ”¯æ’ ${otherLabel}`;
                res.logic = `é€™å°±åƒ**æ³¥è©è–©éæ±Ÿ**ï¼Œè‡ªèº«é›£ä¿é‚„æƒ³æ•‘äººã€‚${why}ä½†éåº¦çš„ä»˜å‡ºå·²ç¶“é€æ”¯äº†æ‚¨çš„èƒ½é‡ï¼Œå»ºè­°å…ˆç…§é¡§å¥½è‡ªå·±ã€‚`;
            } else {
                res.grade = "å¹³"; res.color = "#ffeaa7"; res.title = "æ‰è¯å±•ç¾";
                res.scene = `æ‚¨ç‡ƒç‡’ ${meLabel} çš„èƒ½é‡å»æˆå°± ${otherLabel}`;
                res.logic = `é€™æ˜¯ä¸€ç¨®ä»˜å‡ºçš„æ ¼å±€ã€‚${why}æ‚¨å°‡ç²¾åŠ›æŠ•å…¥åˆ°å‰µä½œæˆ–æœå‹™ä¸­ï¼Œé›–ç„¶èº«é«”ç–²æ†Šï¼Œä½†èƒ½ç²å¾—åè²èˆ‡æˆå°±æ„Ÿã€‚`;
            }
        }

        // 5. æ¯”å’Œ (åŒé¡äº’å‹•)
        else { 
            if (me.str >= 4 && other.str >= 4) {
                res.grade = "å‡¶"; res.color = "#d63031"; res.title = "å…©å¼·ç›¸çˆ­";
                res.scene = `å¼·å‹¢çš„ ${meLabel} é‡ä¸Šäº†åŒæ¨£å¼·ç¡¬çš„ ${otherLabel}`;
                res.logic = `é€™å°±åƒ**å…©æŠŠå¯¶åŠäº’ç **ï¼Œå¿…æœ‰æå‚·ã€‚åŒé¡ä¹‹é–“ç«¶çˆ­æ¿€çƒˆï¼Œäº’ä¸ç›¸è®“ï¼Œå®¹æ˜“å¼•ç™¼å£è§’ã€‚å»ºè­°ä¿æŒè·é›¢ï¼Œå„è¡Œå…¶é“ã€‚`;
            } else {
                res.grade = "å‰"; res.color = "#0984e3"; res.title = "æ”œæ‰‹åŒè¡Œ";
                res.scene = `${meLabel} èˆ‡ ${otherLabel} ç›¸äº’è¼æ˜ `;
                res.logic = `å¦‚åŒ**ç™¾å·åŒ¯æµ·**ï¼ŒåŠ›é‡åŠ å€ã€‚é©åˆå°‹æ‰¾åˆä½œå¤¥ä¼´ï¼Œåœ˜éšŠåˆä½œèƒ½è®“äº‹æƒ…é€²å±•æ›´é †åˆ©ã€‚`;
            }
        }

        return res;
    }

    // ===========================================================
    // 5. æ¸²æŸ“çµæœ
    // ===========================================================
    function renderMacro(u) {
        const yRes = analyzeInteraction(u.dNY, todayData.y); // ä»¥æ—¥æŸ±(è‡ªæˆ‘)å°æµå¹´
        const mRes = analyzeInteraction(u.mNY, todayData.m); // ä»¥æœˆæŸ±(å…§å¿ƒ)å°æµæœˆ

        document.getElementById('macro-content').innerHTML = `
            ${genCard(`æµå¹´é‹å‹¢ (${normalize(todayData.y)})`, yRes)}
            ${genCard(`æµæœˆé‹å‹¢ (${normalize(todayData.m)})`, mRes)}
        `;
    }

    function renderDaily(u) {
        // æ„›æƒ…ï¼šæ—¥æŸ± vs æµæ—¥
        const love = analyzeInteraction(u.dNY, todayData.d);
        let loveMsg = love.grade.includes("å‰") ? "ğŸ’• ä»Šæ—¥é­…åŠ›åŠ åˆ†ï¼Œé©åˆç´„æœƒã€‚" : "ğŸ›¡ï¸ å¤šåŒ…å®¹å°æ–¹ï¼Œé¿å…çˆ­åŸ·ã€‚";

        // äº‹æ¥­ï¼šæœˆæŸ± vs æµæ—¥
        const career = analyzeInteraction(u.mNY, todayData.d);
        
        // è²¡å¯Œï¼šæ—¥æŸ± vs æµæ—¥ (éœ€è¦ç‰¹æ®Šè™•ç†ï¼Œä½†ä¹Ÿéœ€è¦é¡¯ç¤ºç´éŸ³äº¤äº’)
        const wealth = analyzeInteraction(u.dNY, todayData.d);
        
        // è¦†è“‹è²¡å¯Œé‚è¼¯ä½†ä¿ç•™äº¤äº’éç¨‹
        const uD = getData(u.dNY);
        const tD = getData(todayData.d);
        const rel = RELATION_MAP[uD.el][tD.el];
        
        let wTitle = "è²¡é‹å¹³å¹³";
        // å°‡åŸæœ¬çš„äº’å‹•é‚è¼¯ä¿ç•™ï¼Œä¸¦åŠ ä¸Šè²¡å¯Œè§£è®€
        let wLogicPrefix = `<strong>ã€ç´éŸ³äº¤äº’ã€‘</strong><br>${wealth.scene}<br>${wealth.logic}<br><br><strong>ã€è²¡é‹è§£è®€ã€‘</strong><br>`;
        
        if (rel === "æˆ‘å‰‹") {
            if (uD.str >= 3) {
                wTitle = "è²¡æ˜Ÿé«˜ç…§"; wealth.grade = "å¤§å‰"; wealth.color = "#00b894";
                wealth.logic = wLogicPrefix + `é€™æ˜¯æ¨™æº–çš„ã€Œæˆ‘å‰‹è€…ç‚ºè²¡ã€ã€‚æ‚¨ä»Šæ—¥å°è³‡æºæœ‰æ¥µå¼·çš„æŒæ§åŠ›ï¼Œé©åˆè«‡åˆ¤ã€æ”¶å¸³ã€æŠ•è³‡ã€‚`;
            } else {
                wTitle = "è²¡å¤šèº«å¼±"; wealth.grade = "å‡¶"; wealth.color = "#d63031";
                wealth.logic = wLogicPrefix + `çœ‹åˆ°äº†æ©Ÿæœƒå»æŠ“ä¸ä½ã€‚å‹¿è²ªåœ–è¶…å‡ºèƒ½åŠ›çš„åˆ©ç›Šï¼Œå¦å‰‡åå—å…¶å®³ã€‚`;
            }
        } else if (rel === "ç”Ÿæˆ‘") {
             wTitle = "è²´äººé€è²¡"; wealth.grade = "å‰"; wealth.color = "#0984e3";
             wealth.logic = wLogicPrefix + `è²¡å¯Œä¾†è‡ªä»–äººçš„é¤½è´ˆæˆ–è¢«å‹•æ”¶å…¥ï¼Œå¾—ä¾†å…¨ä¸è²»å·¥å¤«ã€‚`;
        } else {
             wealth.logic = wLogicPrefix + `ä»Šæ—¥è²¡é‹èˆ‡ä¸Šè¿°ç´éŸ³äº’å‹•ç‹€æ…‹ä¸€è‡´ï¼Œç„¡ç‰¹æ®Šè²¡æ˜Ÿç…§è€€ï¼Œå®œå®ˆæˆã€‚`;
        }

        document.getElementById('daily-content').innerHTML = `
            <div class="fortune-item">
                <div class="f-head"><span class="f-title">ğŸ’˜ æ„›æƒ…é‹å‹¢</span><span class="f-badge" style="background:${love.color}">${love.grade}</span></div>
                <div class="scene-box">ğŸ–¼ï¸ ${love.scene}</div>
                <div class="f-text">${love.logic}</div>
                <div class="lucky-tip">ğŸ’¡ å»ºè­°ï¼š${loveMsg}</div>
            </div>

            <div class="fortune-item">
                <div class="f-head"><span class="f-title">ğŸ’¼ äº‹æ¥­é‹å‹¢</span><span class="f-badge" style="background:${career.color}">${career.grade}</span></div>
                <div class="scene-box">ğŸ–¼ï¸ ${career.scene}</div>
                <div class="f-text">${career.logic}</div>
            </div>

            <div class="fortune-item">
                <div class="f-head"><span class="f-title">ğŸ’° è²¡å¯Œé‹å‹¢ï¼š${wTitle}</span><span class="f-badge" style="background:${wealth.color}">${wealth.grade}</span></div>
                <div class="f-text">${wealth.logic}</div>
            </div>
        `;
    }

    function genCard(title, res) {
        return `
            <div class="fortune-item">
                <div class="f-head"><span class="f-title">${title}ï¼š${res.title}</span><span class="f-badge" style="background:${res.color}">${res.grade}</span></div>
                <div class="scene-box">ğŸ–¼ï¸ ${res.scene}</div>
                <div class="f-text">${res.logic}</div>
            </div>
        `;
    }

    function setTxt(id, val) { document.getElementById(id).textContent = val || "--"; }

</script>

</body>
</html>
