<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>年月日干支與納音五行對照</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background-color: #f4f4f9;
            color: #333;
        }
        .container {
            max-width: 600px;
            margin: auto;
            background: #fff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        h2 {
            text-align: center;
            color: #007bff;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-top: 10px;
            font-weight: bold;
        }
        input[type="number"] {
            width: calc(33% - 10px);
            padding: 10px;
            margin-right: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }
        button {
            width: 100%;
            padding: 12px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #218838;
        }
        .result-box {
            margin-top: 25px;
            padding: 15px;
            border: 1px dashed #007bff;
            border-radius: 8px;
            background-color: #e9f7ff;
        }
        .result-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px dotted #ccc;
        }
        .result-item:last-child {
            border-bottom: none;
        }
        .label {
            font-weight: bold;
            color: #0056b3;
        }
        .value {
            color: #c82333;
            font-weight: 600;
        }
        /* 針對行動裝置 */
        @media (max-width: 600px) {
             input[type="number"] {
                width: 100%;
                margin-right: 0;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <h2>公曆轉干支與納音五行</h2>
    
    <label for="year">輸入公曆日期 (年/月/日):</label>
    <input type="number" id="year" placeholder="年 (e.g., 2024)" min="1900" max="2100">
    <input type="number" id="month" placeholder="月 (1-12)" min="1" max="12">
    <input type="number" id="day" placeholder="日 (1-31)" min="1" max="31">
    
    <button onclick="calculateGanzhiNayin()">計算</button>
    
    <div id="output" class="result-box" style="display:none;">
        <h3>查詢結果</h3>
        </div>
    
    <p style="font-size: 12px; margin-top: 20px; color: #666;">
        <strong>註：</strong>年干支採用農曆年循環，月干支採用近似的節氣月份對應。日干支採用天文學儒略日演算法，準確性高。月干支的精確計算需複雜的二十四節氣時刻數據，此處為簡化版。
    </p>
</div>

<script>
// --- 核心資料庫 ---
const HEAVENLY_STEMS = ["甲", "乙", "丙", "丁", "戊", "己", "庚", "辛", "壬", "癸"];
const EARTHLY_BRANCHES = ["子", "丑", "寅", "卯", "辰", "巳", "午", "未", "申", "酉", "戌", "亥"];

// 納音五行對照表 (Key: 干支索引 (0-59), Value: 納音五行名稱)
const NAYIN_WUXING = [
    "海中金", "海中金", "爐中火", "爐中火", "林木", "林木", "路旁土", "路旁土", "劍鋒金", "劍鋒金",
    "山頭火", "山頭火", "澗下水", "澗下水", "城頭土", "城頭土", "白蠟金", "白蠟金", "楊柳木", "楊柳木",
    "泉中水", "泉中水", "屋上土", "屋上土", "霹靂火", "霹靂火", "松柏木", "松柏木", "長流水", "長流水",
    "沙中金", "沙中金", "山下火", "山下火", "平地木", "平地木", "壁上土", "壁上土", "金箔金", "金箔金",
    "覆燈火", "覆燈火", "天河水", "天河水", "大驛土", "大驛土", "釵釧金", "釵釧金", "桑柘木", "桑柘木",
    "大溪水", "大溪水", "沙中土", "沙中土", "天上火", "天上火", "石榴木", "石榴木", "大海水", "大海水"
];

// 農曆月份對應的起始地支 (從寅月開始)
// 寅=1月，卯=2月, ..., 丑=12月 (註：此為近似，月干支應以節氣定，此處僅用於簡化計算)
const MONTH_BRANCH_START_INDEX = [0, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 0, 1]; 
// 0: 無效, 1: 寅(2), 2: 卯(3), ..., 12: 丑(1)

// --- 核心計算函數 ---

/**
 * 根據干支的索引 (0-59) 取得納音五行名稱。
 * @param {number} index - 干支索引 (0-59).
 * @returns {string} - 納音五行名稱.
 */
function getNayin(index) {
    if (index >= 0 && index < 60) {
        return NAYIN_WUXING[index];
    }
    return "計算錯誤";
}

/**
 * 將公曆日期轉換為儒略日數 (Julian Day Number, JDN)。
 * 這是計算日干支的基礎。
 * @param {number} Y - 年.
 * @param {number} M - 月.
 * @param {number} D - 日.
 * @returns {number} - 儒略日數.
 */
function gregorianToJDN(Y, M, D) {
    let a = Math.floor((14 - M) / 12);
    let y = Y + 4800 - a;
    let m = M + 12 * a - 3;
    
    // JDN 公式 (適用於格里曆，即 1582年10月15日及以後)
    let jdn = D + Math.floor((153 * m + 2) / 5) + 365 * y + Math.floor(y / 4) - Math.floor(y / 100) + Math.floor(y / 400) - 32045;
    
    return jdn;
}

/**
 * 根據儒略日數計算日干支的索引 (0-59)。
 * 基準點: 公曆 1899年12月6日 (甲子日) JDN = 2414985
 * @param {number} jdn - 儒略日數.
 * @returns {number} - 日干支索引 (0-59).
 */
function getDailyGanzhiIndex(jdn) {
    const JDN_START_GANZHI_INDEX = 0; // 甲子 (索引 0)
    const JDN_START = 2414985; // 1899/12/06 是 甲子日
    
    let offset = jdn - JDN_START;
    let index = (offset % 60 + 60) % 60; // 確保結果為正
    
    return index;
}

/**
 * 根據索引計算完整的干支字串。
 * @param {number} index - 干支索引 (0-59).
 * @returns {string} - 干支字串 (例如 "甲子").
 */
function getGanzhiString(index) {
    let ganIndex = index % 10;
    let zhiIndex = index % 12;
    return HEAVENLY_STEMS[ganIndex] + EARTHLY_BRANCHES[zhiIndex];
}

/**
 * 根據年份計算年干支的索引 (0-59)。
 * 基準點: 公曆 1924年 (甲子年) - 索引 0
 * @param {number} year - 年份.
 * @returns {number} - 年干支索引 (0-59).
 */
function getYearGanzhiIndex(year) {
    // 1924年是甲子年 (索引 0)
    // Formula: (Year - 4) mod 60, where 4 is the remainder of 1924/60.
    // 1924 mod 60 = 4. 1924 - 4 = 1920 (整除) -> 甲子年
    // 實際上計算是 (Y - 4) mod 60
    let index = (year - 4) % 60;
    if (index < 0) index += 60;
    return index;
}

/**
 * 根據年份和月份計算月干支的索引 (0-59)。
 * 註：此為**簡化近似**計算，未考慮精確的節氣時刻。
 * @param {number} year - 年份.
 * @param {number} month - 月份 (1-12).
 * @returns {number} - 月干支索引 (0-59).
 */
function getMonthGanzhiIndex(year, month) {
    // 1. 確定月地支 (從寅月開始: 1月=寅, 2月=卯, ..., 12月=丑)
    // 為了對應農曆月 (寅月始)，這裡使用簡化對應：
    // 月地支索引 (0=子, 1=丑, ..., 11=亥)
    let zhiIndex = MONTH_BRANCH_START_INDEX[month];

    // 2. 確定月天干
    // 月天干是根據年天干和月地支確定的。
    // 年天干索引: 0=甲, 1=乙, ..., 9=癸
    let yearGanIndex = getYearGanzhiIndex(year) % 10;
    
    // 口訣: 五虎遁月歌 (甲己之年丙作首)
    // 年干索引 (0-9) 決定正月(寅月)的天干索引 (0-9)
    const monthGanStartOffset = [2, 4, 6, 8, 0, 2, 4, 6, 8, 0]; // 寅月的天干索引
    
    let startGanIndex = monthGanStartOffset[yearGanIndex];
    
    // 計算當前月的天干索引 (月支從寅(2)開始，所以需要調整)
    // 寅月(3) 卯月(4) 辰月(5) 巳月(6) 午月(7) 未月(8) 申月(9) 酉月(10) 戌月(11) 亥月(0) 子月(1) 丑月(2)
    // 1月是寅月，地支索引是 2
    let zhiOffset;
    if (month >= 3) {
        zhiOffset = month - 3; // 3月是辰月 (地支索引 4), 辰(4) - 寅(2) = 2
    } else {
        // 1月寅, 2月卯
        zhiOffset = month + 9;
    }
    
    // 計算天干
    let ganIndex = (startGanIndex + zhiOffset) % 10;
    
    // 組合干支索引: 天干 * 12 + 地支, 但需要找到它們在 60 甲子中的位置
    // 簡化方法：計算出干支字串後，從 HEAVENLY_STEMS 和 EARTHLY_BRANCHES 組合查找
    // 月干支索引 = (月天干索引 * 12 + 月地支索引) 
    // 更簡單：計算月天干和月地支，然後找到它們在 60 甲子中的共同索引。
    
    // 由於地支索引是從子(0)開始，而寅月地支索引是 2，故月地支與月數的關係為：
    // 月份: 1(寅), 2(卯), 3(辰), ..., 12(丑)
    // 地支索引: 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 0, 1 (模 12)
    let monthBranchIndex = (month + 1) % 12; // 1月: 2 (寅), 2月: 3 (卯), ..., 12月: 1 (丑)

    // 月干索引的正確公式: (年干索引 * 2 + 該月地支索引 + 2) mod 10
    // 該月地支索引: 2(寅), 3(卯)...
    let monthGanIndex = (yearGanIndex * 2 + monthBranchIndex + 2) % 10;
    
    // 組合索引 (標準公式: 6 * T + Z, T=天干, Z=地支，但這是個錯誤的公式)
    // 正確組合: (干索引 * 12 + 支索引 * 10) mod 60 (但這也需要解線性同餘)
    
    // 最簡單方式：找到 (月天干, 月地支) 在 60 循環中的唯一索引
    for (let i = 0; i < 60; i++) {
        if (i % 10 === monthGanIndex && i % 12 === monthBranchIndex) {
            return i;
        }
    }
    return -1; // 理論上不會發生
}


// --- 主控邏輯 ---

function calculateGanzhiNayin() {
    const Y = parseInt(document.getElementById('year').value);
    const M = parseInt(document.getElementById('month').value);
    const D = parseInt(document.getElementById('day').value);
    const outputDiv = document.getElementById('output');
    outputDiv.style.display = 'none';
    outputDiv.innerHTML = '';

    // 驗證輸入
    if (isNaN(Y) || isNaN(M) || isNaN(D) || Y < 1900 || M < 1 || M > 12 || D < 1 || D > 31) {
        alert("請輸入有效的公曆年月日 (年份建議在 1900-2100 之間)。");
        return;
    }
    
    // 1. 計算日干支
    const jdn = gregorianToJDN(Y, M, D);
    const dayGanzhiIndex = getDailyGanzhiIndex(jdn);
    const dayGanzhi = getGanzhiString(dayGanzhiIndex);
    const dayNayin = getNayin(dayGanzhiIndex);
    
    // 2. 計算年干支
    const yearGanzhiIndex = getYearGanzhiIndex(Y);
    const yearGanzhi = getGanzhiString(yearGanzhiIndex);
    const yearNayin = getNayin(yearGanzhiIndex);

    // 3. 計算月干支 (近似)
    const monthGanzhiIndex = getMonthGanzhiIndex(Y, M);
    const monthGanzhi = getGanzhiString(monthGanzhiIndex);
    const monthNayin = getNayin(monthGanzhiIndex);

    // 顯示結果
    let html = `
        <div class="result-item">
            <span class="label">日期：</span>
            <span class="value">${Y}年${M}月${D}日</span>
        </div>
        
        <div class="result-item">
            <span class="label">年干支 (年柱)：</span>
            <span class="value">${yearGanzhi}</span>
        </div>
        <div class="result-item">
            <span class="label">年納音五行：</span>
            <span class="value">${yearNayin}</span>
        </div>
        
        <div class="result-item">
            <span class="label">月干支 (月柱, 近似)：</span>
            <span class="value">${monthGanzhi}</span>
        </div>
        <div class="result-item">
            <span class="label">月納音五行：</span>
            <span class="value">${monthNayin}</span>
        </div>

        <div class="result-item">
            <span class="label">日干支 (日柱)：</span>
            <span class="value">${dayGanzhi}</span>
        </div>
        <div class="result-item">
            <span class="label">日納音五行：</span>
            <span class="value">${dayNayin}</span>
        </div>
    `;

    outputDiv.innerHTML = html;
    outputDiv.style.display = 'block';
}
</script>

</body>
</html>
